#cloud-config
# Coolify初期セットアップ用のcloud-init設定

# パッケージのアップデートを実行
package_update: true
package_upgrade: true

# 必要なパッケージをインストール
packages:
  - curl
  - ca-certificates
  - gnupg
  - lsb-release

# Coolifyのインストール
runcmd:
  # Coolifyのインストール（バックグラウンドで実行）
  - curl -fsSL https://get.coolify.io | bash
  
  # インストール完了の確認用ファイルを作成
  - echo "Coolify installation initiated at $(date)" > /var/log/coolify-install.log

# タイムゾーン設定
timezone: Asia/Tokyo

# SSHの設定
ssh_pwauth: true
disable_root: false

# 完了時のメッセージ
final_message: |
  Coolify installation has been initiated.
  Please wait a few minutes for the installation to complete.
  You can check the status with: docker ps
  
  Access Coolify dashboard:
  - Internal: http://<this-vm-ip>:8000
  - Via Cloudflare Tunnel: Add to services variable in variables.tf
